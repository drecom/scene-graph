<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="viewport-fit=cover, width=device-width, initial-scale=1.0, user-scalable=no" />
  <script type='text/javascript' src='/three.min.js'></script>
  <script type='text/javascript' src='/scene-graph-mediator-rt.js'></script>
<head/>
<body>
  <script type='text/javascript'>
    window.onload = function() {
      // pixi runtime mediator
      const Importer = window["scene-graph-mediator-rt"].Importers.Three;

      window.scene = new THREE.Scene();
      scene.background = new THREE.Color(0xa0a0a0);
      scene.fog = new THREE.Fog(0xa0a0a0, 200, 1000);

      // TODO: should be exported
      const camera = new THREE.PerspectiveCamera(30, window.innerWidth / window.innerHeight, 1, 5000);
      camera.position.set(0, 50, 300);

      const lightHemisphere = new THREE.HemisphereLight(0xffffff, 0x444444);
      lightHemisphere.position.set(0, 200, 0);
      scene.add(lightHemisphere);
      const lightDirectional = new THREE.DirectionalLight(0xffffff);
      lightDirectional.position.set(0, 200, 100);
      lightDirectional.castShadow = true;
      scene.add(lightDirectional);

      const renderer = new THREE.WebGLRenderer({ antialias: true });
      renderer.setPixelRatio(window.devicePixelRatio);
      renderer.setSize(window.innerWidth, window.innerHeight);
      renderer.shadowMap.enabled = true;
      window.document.body.appendChild(renderer.domElement);

      const animate = () => {
        requestAnimationFrame(animate);
        renderer.render(scene, camera);
      }

      const loader = new THREE.FileLoader();
      loader.setResponseType('json');
      loader.load('/graph.unity.json', (sceneGraph) => {
        // instantiate scene-graph family
        const importer = new Importer();
        // import scene-graph
        importer.import(sceneGraph, (root) => {
          scene.add(root.children[0]);
        });

        animate();
      });
    };
  </script>
</body>
</html>
