!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports["scene-graph-cocos-animation-rt"]=t():e["scene-graph-cocos-animation-rt"]=t()}(window,function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0)}([function(e,t,n){"use strict";n.r(t);var r=function(){function e(e,t){this.fps=60,this.paused=!1,this.elapsedTime=0,this.animation=e,this.target=t,this.animationFrameTime=1/this.animation.sample,this.curveFuncsMap=new Map;for(var n=Object.keys(this.animation.curves),r=0;r<n.length;r++){for(var i=n[r],o=[],a=this.animation.curves[i],s=0;s<a.keyFrames.length;s++){var c=a.keyFrames[s],f=u.getCurveFunction(c.curve);o.push(f)}this.curveFuncsMap.set(i,o)}}return Object.defineProperty(e.prototype,"spf",{get:function(){return 1/this.fps},enumerable:!0,configurable:!0}),e.prototype.pause=function(){this.paused=!0},e.prototype.resume=function(){this.paused=!1},e.prototype.reset=function(){this.elapsedTime=0},e.prototype.getCurrentFrameIndex=function(e,t,n){for(var r=1/n,i=e.length-1;i>=0;i--){if(r*(n*e[i].frame)<t)return i}return-1},e.prototype.update=function(e){if(!this.paused){this.elapsedTime+=e*this.spf;for(var t=!1,n=Object.keys(this.animation.curves),r=0;r<n.length;r++){var i=n[r],o=this.animation.curves[i],a=this.getCurrentFrameIndex(o.keyFrames,this.elapsedTime,this.animation.sample);if(!(-1===a||a>=o.keyFrames.length-1)){var s=o.keyFrames[a],u=o.keyFrames[a+1],c=this.curveFuncsMap.get(i);if(c&&0!=c.length){var f=c[a],m=this.animationFrameTime*(this.animation.sample*s.frame),p=(this.elapsedTime-m)/(this.animationFrameTime*(this.animation.sample*u.frame)-m),h=s.value,l=u.value;if("number"==typeof h){var d=l-h;this.target[i]=h+d*f(p)}else for(var v=Object.getOwnPropertyNames(h),g=0;g<v.length;g++){var y=v[g],b=l[y],M=h[y],x=(d=b-M,f(p));this.target[i][y]=M+d*x}t=!0}}}t||(this.paused=!0)}},e}(),i={linear:function(e){return e},quadOut:function(e){return e*(2-e)}},o=2*Math.PI;function a(e){return e<0?-Math.pow(-e,1/3):Math.pow(e,1/3)}function s(e){return function(t){return function(e,t){var n=function(e,t){var n=t,r=t-e[0],i=3*n,s=3*r,u=3*(t-e[2]),c=1/(-n+s-u+(t-1)),f=(i-6*r+u)*c,m=f*(1/3),p=(-i+s)*c,h=1/3*(3*p-f*f),l=h*(1/3),d=(2*f*f*f-9*f*p+n*c*27)/27,v=d/2,g=v*v+l*l*l;if(g<0){var y=1/3*-h,b=y*y*y,M=Math.sqrt(b),x=-d/(2*M),F=x<-1?-1:x>1?1:x,j=Math.acos(F),O=2*a(M),T=O*Math.cos(j*(1/3))-m,w=O*Math.cos((j+o)*(1/3))-m,P=O*Math.cos((j+2*o)*(1/3))-m;return 0<=T&&T<=1?0<=w&&w<=1?0<=P&&P<=1?Math.max(T,w,P):Math.max(T,w):0<=P&&P<=1?Math.max(T,P):T:0<=w&&w<=1?0<=P&&P<=1?Math.max(w,P):w:P}if(0===g){var k=v<0?a(-v):-a(v);return w=-k-m,0<=(T=2*k-m)&&T<=1?0<=w&&w<=1?Math.max(T,w):T:w}var A=Math.sqrt(g);return a(-v+A)-a(v+A)-m}(e,t),r=1-n;return 3*e[1]*n*r*r+3*e[3]*n*n*r+n*n*n}(e,t)}}var u=function(){function e(){}return e.prototype.extendRuntimeObjects=function(e,t,n){t.forEach(function(e,t){if(e.animations){var i=n.get(t);if(i.sgmed||(i.sgmed={}),i.sgmed.cocosAnimations=e.animations,i.sgmed.cocosAnimations)for(var o=0;o<i.sgmed.cocosAnimations.length;o++){var a=i.sgmed.cocosAnimations[o];a.runtime=new r(a,i)}}})},e.prototype.filterAnimationContainer=function(e,t){void 0===t&&(t=[]),e.sgmed&&e.sgmed.cocosAnimations&&t.push(e);for(var n=0;n<e.children.length;n++)this.filterAnimationContainer(e.children[n],t);return t},e.getCurveFunction=function(e){return e?"string"==typeof e?i.hasOwnProperty(e)?i[e]:i.linear:s(e):i.linear},e}(),c=u;t.default=c}])});